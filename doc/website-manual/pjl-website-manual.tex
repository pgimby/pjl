%\input{standard-preamble.tex}
\documentclass[justified]{book}
\usepackage{dirtree}
\usepackage{listings,lstautogobble}
\usepackage{xcolor}
\definecolor{light-gray}{gray}{0.9}
\lstset{backgroundcolor = \color{light-gray},
		autogobble=true
}



\begin{document}



\title{Educational Laboratory Website Manual}
\maketitle
\tableofcontents
%\vspace{-1.5cm}
%\today
%\begin{adjustwidth}{}{-153pt}

\section{Introduction}

The purposes of the pjl website is to be the central information hub for the educational physics labs. It is a base of knowledge from which the department can work collaboratively on building the future of education physics labs.

\newpage

\section{Making Changes to Website}

All changes to the website should be made on the development space on slug (/usr/local/master/pjl-web). The only exception to this rule is that the equipment database equipmentDB.xml can be modified live by using the inventory website in edit mode. Because of this it is important to sync the development and live version of the website before making changes.

\subsection{Sync Live Version and Development Space}

The script ``liveUpdate.py" (Listing \ref{liveUpdate}) has been designed to sync the live version of the website with the development space for the website. It is important to run this script before and after making changes to the development space. It is run the first time to make sure that the equipment xml file in development has been updated with the changes that made directly on the pjl website. Once the changes to the development space have been made and tested the changes can be pushed to the web-server by running the same command again.

\vspace{12pt}
\noindent To sync run...
\begin{lstlisting}[backgroundcolor = \color{light-gray}]
sudo ./liveUpdate.py
\end{lstlisting}

\noindent The command can also be run in test mode by excecuting...

\begin{lstlisting}[backgroundcolor = \color{light-gray}]
sudo ./liveUpdate.py -t
\end{lstlisting}


\section{Repository}

\subsection{Directory structure}

At top most level is a folder called ``repository" that contains all experiment related documents.\\

\noindent At the second level all the files are organized by lab experiment. Each experiment has a folder that is labeled with a naming scheme where the first four characters are the unique identifier number, followed by the name of the lab. The lab name should be descriptive of the experiment itself. In this folder is also a folder called ``Support\_Docs" that contains any documents useful for the experiment, but not actually used to generate the student document. \\

\noindent At the third level files are organized into versions. Each folder follows a naming scheme where the the first four characters are the unique lab identifier number, followed by ``PHYS" followed by the Course Number followed by a two character semester identifier, followed by the year. Each folder contains all the file used to generate the pdf given to students in the course, semester, and year as identified in the folder label. \\

\noindent {\bf Directory structure sample.}

\dirtree{%
.1 /repository.
.2 0072-Nuclear-Decay.
.3 0001-PHYS123FA2017.
.4 lab.tex.
.4 photo.jpg.
.4 student.pdf.
.2 Support\_Docs.
}
\vspace{12pt}
{\bf Documents can only be added to the repository if they meet the following criteria.}
\begin{enumerate}
\item The files include the pdf given to students to be used in their course work.
\item All files need to generate the pdf are included.
\end{enumerate}


%\end{enumerate}
%\item Upload changes made to Watt to github.

\subsection{Adding a new lab to the repository}

Before beginning ensure that all equipment used in the new experiment are in the lab inventory, and have equipment ID number. 

\begin{enumerate}
\item Create a folder for the new lab (example ``new-lab-folder"), and place all files for generating student pdf, and the student pdf in new-lab-folder
\item Inside new-lab-folder make a directory called ``Support\_Docs", and put all documents relevant to lab, but not needed for generation of pdf into it. This might include research papers, sample data, Excel spreadsheets, etc.
\item Inside new-lab-folder create a file called info.csv and add all relevant information to the file.\\

%Example: The file info.csv needs to be in this form. See below for more details.

\begin{lstlisting}[backgroundcolor = \color{light-gray},
					caption = The file info.csv needs to be in this form. See below for more details
                   %language = C,
                   xleftmargin = 2cm,
                   framexleftmargin = 1em
                   ]
Name,Vectors-in-One-and-Two-Dimensions
Type,Labatorial
Disciplines,Newtonian Mechanics,Optics
Topics,Collisions,Momentum
Semester,Fall
Year,2017
Course,325
Equipment,0004-(1)-[0002],0050-(4)
Software,ImageJ,Canon
PDF,title.pdf
\end{lstlisting}


Any text that is \textbf{Bold} must be configured for each lab. text in \textit{italic} are notes that must be removed. Standard text must be left as is.

\begin{itemize}
\item Name, \textbf{Name as to be Seen on Website} \textit{ Use Standard Title Capitalize Convention.}
\item Type, \textbf{Type} \textit{ Must be either Lab or Labatorial.}
\item Disciplines, \textbf{Discipline1, Discipline2} \textit{ Disciplines must comma separated be taken from the approved list} \textbf{Need location of this list.}
\item Topics, \textbf{Topic1, Topic2} \textit{ Topics must comma separated be taken from the approved list} \textbf{Need location of this list.}
\item Semester, \textbf{Semester} \textit{ Winter, Spring, Summer, or Fall}
\item Year, \textbf{Year} \textit{: Four digits.}
\item Course, \textbf{Course Number} \textit{ Three digit number corresponding to the course the experiment was used in.}
\item Equipment, \textbf{equipID-(Amount)-[alternate equipID], equipID-(Amount)} \textit{ equipID is four digit code of equipment in inventory, Amount is how many are needed, alternate ID is the four digit code of equipment in inventory that can be used if the primary unit is not available. IDs amounts and alternate IDs separated by ``-", and items in equipment list separated by ``,"}
\item Software, \textbf{Software1, Software2} \textit{ Name of all software needed. Must be software from the list of supported software} \textbf{Need location of this list}
\item PDF, \textbf{PDF exact Name} \textit{ This needs to be the exact name of the student pdf}
\end{itemize}	

\item Run ``addNewLab.py /path/to/new-lab-folder" from development space. 
\end{enumerate}

\subsection{Repository xml template}

\lstinputlisting[language=xml, linerange = {7-49}, backgroundcolor = \color{light-gray}, basicstyle = \footnotesize, xleftmargin = 2cm, framexleftmargin = 1em]{/usr/local/master/pjl-web/doc/website-manual/code-samples/labDB-template.txt}




\section{Inventory}

\subsection{Inventory structure}

Each item in the inventory should have a unique identifier number, and a unique name. Each item has a place for any number of manuals, and one picture. 


\subsection{Deleting Old Equipment}

To remove a piece of old equipment run, from the python-tools folder, the command,

%[backgroundcolor = \color{light-gray},
%					autogobble=true
%					]

\begin{lstlisting}
./equipmentEdit.py -d [idnum]       
\end{lstlisting}

If the piece of equipment is currently listed as part of the equipment list for a current lab the script will prompt you to make sure that you know this. Ideally the equipment list in the lab repository should be updated first before removing the equipment. This will help to keep the lab equipment lists and the equipment database in sync. 

\subsection{Adding New Equipment}

There two ways to add a piece of equipment. 
\begin{itemize}

\item You can add each item individually with just a name only, and then used the ``edit mode" on the live site to add further information about the item.

\item You can generate a csv file that contains all the relevant information, and then import that information into the database.
\end{itemize}

\subsubsection{Adding each piece individually}

\noindent To add an individual piece of new equipment to the equipment database.

\begin{enumerate}
	\item From the /dev/python-tools folder, the command,

	\begin{lstlisting}
	./equipmentEdit.py -a "Name of equipment"       
	\end{lstlisting}

	Note that the quotation marks around the name is important, if they are missing the new piece 			of equipment will be call Name.

	\item From the /data folder run the command,
	
	\begin{lstlisting}
	./liveUpdate       
	\end{lstlisting}
	
	which will replace the equipmentDB.xml file to be served, while  backing up the previous 				versions.
	
\end{enumerate}
\begin{enumerate}
\item Compile all rel

	\begin{lstlisting}[backgroundcolor = \color{light-gray}, 	caption = The file info.csv needs to be in this form.
	               language = csv, xleftmargin = -2cm, xrightmargin = -2cm,
                   framexleftmargin = 1em
                   ]
                   
name; Unique Name of Kit, is_kit; False, kit ; item1 ; item2 ; item3 (2)
name; Unique Name of Equipment

\end{lstlisting}

\end{enumerate}

\subsection{Adding photos of equipment}


\section{Schedules}

\noindent The name of the current schedules should be

\begin{itemize}
\item schedule-current.pdf
\item rooms-current.pdf
\end{itemize}


\section{Scripts}

\subsection{Add New Lab - addNewLab.py}
%	\begin{lstlisting}[backgroundcolor = \color{lightgray},
 %                  language = python,
  %                 xleftmargin = -4cm,
   %                framexleftmargin = 1em,
    %               xrightmargin = -4cm,
     %             framexrightmargin = 1em
      %             ]


\lstinputlisting[label = addnNew, language=python, backgroundcolor = \color{light-gray}, basicstyle = \footnotesize, xleftmargin = -3cm, xrightmargin = -3cm]{/usr/local/master/pjl-web/dev/python-tools/addNewLab.py}

\lstinputlisting[label = liveUpdate, language=python, backgroundcolor = \color{light-gray}, basicstyle = \footnotesize, xleftmargin = -3cm, xrightmargin = -3cm]{/usr/local/master/pjl-web/dev/python-tools/liveUpdate.py}

%\end{lstlisting}

%\end{adjustwidth}
\end{document}
