%\input{standard-preamble.tex}
\documentclass[justified]{book}
\usepackage{dirtree}
\usepackage{listings,lstautogobble}
\usepackage{xcolor}
\definecolor{light-gray}{gray}{0.9}
\lstset{backgroundcolor = \color{light-gray},
		autogobble=true
}



\begin{document}



\title{Educational Laboratory Website Manual}
\maketitle
\tableofcontents
%\vspace{-1.5cm}
%\today
%\begin{adjustwidth}{}{-153pt}

\section{Introduction}

The purposes of the pjl website is to be the central information hub for the educational physics labs. It is a base of knowledge from which the department can work collaboratively on building the future of education physics labs.

\newpage

\section{Making Changes to Website}

All changes to the website should be made on the development space on slug (/usr/local/master/pjl-web). The only exception to this rule is that the equipment database equipmentDB.xml can be modified live by using the inventory website in edit mode. Because of this it is important to sync the development and live version of the website before making changes.

\subsection{Sync Live Version and Development Space}

The script ``liveUpdate.py" (Listing \ref{liveUpdate}) has been designed to sync the live version of the website with the development space for the website. It is important to run this script before and after making changes to the development space. It is run the first time to make sure that the equipment xml file in development has been updated with the changes that made directly on the pjl website. Once the changes to the development space have been made and tested the changes can be pushed to the web-server by running the same command again.

\vspace{12pt}
\noindent To sync run...
\begin{lstlisting}[backgroundcolor = \color{light-gray}]
sudo ./liveUpdate.py
\end{lstlisting}

\noindent The command can also be run in test mode by executing...

\begin{lstlisting}[backgroundcolor = \color{light-gray}]
sudo ./liveUpdate.py -t
\end{lstlisting}


\section{Repository}

\subsection{Directory structure}

At top most level is a folder called ``repository" that contains all experiment related documents.\\

\noindent At the second level all the files are organized by lab experiment. Each experiment has a folder that is labeled with a naming scheme where the first four characters are the unique identifier number, followed by the name of the lab. The lab name should be descriptive of the experiment itself. In this folder is also a folder called ``Support\_Docs" that contains any documents useful for the experiment, but not actually used to generate the student document. \\

\noindent At the third level files are organized into versions. Each folder follows a naming scheme where the the first four characters are the unique lab identifier number, followed by ``PHYS" followed by the Course Number followed by a two character semester identifier, followed by the year. Each folder contains all the file used to generate the pdf given to students in the course, semester, and year as identified in the folder label. \\

\noindent {\bf Directory structure sample.}

\dirtree{%
.1 /repository.
.2 0072-Nuclear-Decay.
.3 0001-PHYS123FA2017.
.4 lab.tex.
.4 photo.jpg.
.4 student.pdf.
.2 Support\_Docs.
}
\vspace{12pt}
{\bf Documents can only be added to the repository if they meet the following criteria.}
\begin{enumerate}
\item The files include the pdf given to students to be used in their course work.
\item All files need to generate the pdf are included.
\end{enumerate}


%\end{enumerate}
%\item Upload changes made to Watt to github.

\subsection{Adding a new version of an existing lab to the repository}

\begin{enumerate}
\item Compile a folder that contains all file needed to generate the lab experiment pdf, as well as any files need for the lab to run (ie, excel templates, vernier cmbl file, or simulations)
\end{enumerate}

\subsection{Adding a new lab to the repository}

Before beginning ensure that all equipment used in the new experiment are in the lab inventory, and have equipment ID number. 

\begin{enumerate}
\item Create a folder for the new lab (example ``new-lab-folder"), and place all files for generating student pdf, and the student pdf in new-lab-folder
\item Inside new-lab-folder make a directory called ``Support\_Docs", and put all documents relevant to lab, but not needed for generation of pdf into it. This might include research papers, sample data, Excel spreadsheets, etc.


%Example: The file info.csv needs to be in this form. See below for more details.

\begin{lstlisting}[backgroundcolor = \color{light-gray}]
sudo ./repositoryEdit -n
\end{lstlisting}

The command can also be run in test mode by executing...

\begin{lstlisting}[backgroundcolor = \color{light-gray}]
sudo ./repositoryEdit -n -t
\end{lstlisting}

The script will now take you through several steps to gather the information needed to properly add this new lab to the repository. There are several safeties built into the code, but there will be a request to review the input information and confirm that it is correct. Please take time at this point to carefully review metadata entered.\\

The disciplines, topics, and software entries must align with the master list contained in /data/validDiciplines.txt, /data/validTopics.txt, and /data/validSoftware.txt. New items must be added to these master lists before they can be added to a lab.

\begin{itemize}
\item Name, \textbf{Name as to be Seen on Website} \textit{ Use Standard Title Capitalize Convention.}
\item Type, \textbf{Type} \textit{ Must be either Lab or Labatorial.}
\item Disciplines, \textbf{Discipline1, Discipline2} \textit{ Disciplines must comma separated be taken from the approved list} \textbf{Need location of this list.}
\item Topics, \textbf{Topic1, Topic2} \textit{ Topics must comma separated be taken from the approved list} \textbf{Need location of this list.}
\item Semester, \textbf{Semester} \textit{ Winter, Spring, Summer, or Fall}
\item Year, \textbf{Year} \textit{: Four digits.}
\item Course, \textbf{Course Number} \textit{ Three digit number corresponding to the course the experiment was used in.}
\item Equipment, \textbf{equipID-(Amount)-[alternate equipID], equipID-(Amount)} \textit{ equipID is four digit code of equipment in inventory, Amount is how many are needed, alternate ID is the four digit code of equipment in inventory that can be used if the primary unit is not available. IDs amounts and alternate IDs separated by ``-", and items in equipment list separated by ``,"}
\item Software, \textbf{Software1, Software2} \textit{ Name of all software needed. Must be software from the list of supported software} \textbf{Need location of this list}
\item PDF, \textbf{PDF exact Name} \textit{ This needs to be the exact name of the student pdf}
\end{itemize}	

\item Run ``addNewLab.py /path/to/new-lab-folder" from development space. 
\end{enumerate}

\subsection{Repository xml template}

\lstinputlisting[language=xml, linerange = {7-49}, backgroundcolor = \color{light-gray}, basicstyle = \footnotesize, xleftmargin = 2cm, framexleftmargin = 1em]{/usr/local/master/pjl-web/doc/website-manual/code-samples/labDB-template.txt}




\section{Inventory}

\subsection{Inventory structure}

Each item in the inventory should have a unique identifier number, and a unique name. An item can be either a stand alone item, or a kit. If the item is a kit it will need to include a list of the items the kit. If only part of the kit are needed for an experiment the repository xml can reference those items by creating a equipment tag in the labDB.xml that has the id number for the kit, but the name for the individual item(s). Each item has a place for any number of manuals, and one picture.\\

\noindent {\bf All changes outlined in this section are made to the development side of the website. Once all changes have been made, and are satisfactory, the live version of documents must be update and the web server must be updated.}


\subsection{Adding New Equipment}

%\noindent To add an individual piece of new equipment to the equipment database.

%\begin{enumerate}
%	\item 
From the /dev/python-tools folder, the command,

	\begin{lstlisting}
	./equipmentEdit.py -n       
	\end{lstlisting}

A prompt will appear that will as for information regarding the new item. Enter all the information available. it is ok leave some fields blank just as long as there is a name. Once all the available information is added a summary will be displayed as well as a request for confirmation. If the user confirms that the information it will go through a validation process to ensure that the name is unique. If everything check out it will be added to the /dev version of the equipmentDB.xml file.

%\end{enumerate}


\subsection{Adding photos of equipment}

When taking photos note that they will require editing before they are added to the database. The final version of photo will be square, so keep this in mind when taking the photographs. Note that all images must be in jpg formate.

\begin{enumerate}
\item Place images in /usr/local/master/labs/rawphotos
\item Rename all images using the scheme [idnum]img.jpg where idnum is the id number of the piece of equipment photographed.
\item Run the conversion script

	\begin{lstlisting}
	./convertImg.py       
	\end{lstlisting}

Edited version will now appear in /usr/local/master/rawimages/output
\item Visually check all photographs in the output folder to confirm that they are still acceptable after they have been converted.
\item Move all photographs ready to be added to the database to /staffresources/equipment/equipimg
\item From /dev/python-tools run the script

	\begin{lstlisting}
	./equipmentEdit.py -i
	\end{lstlisting}

to update the images in the equipmentDB.xml

\end{enumerate}

\subsection{Deleting Old Equipment}

To remove a piece of old equipment run, from the python-tools folder, the command,

%[backgroundcolor = \color{light-gray},
%					autogobble=true
%					]

\begin{lstlisting}
./equipmentEdit.py -d [idnum]       
\end{lstlisting}

If the piece of equipment is currently listed as part of the equipment list for a current lab the script will prompt you to make sure that you know this. Ideally the equipment list in the lab repository should be updated first before removing the equipment. This will help to keep the lab equipment lists and the equipment database in sync. 

\section{Schedules}

\noindent The name of the current schedules should be

\begin{itemize}
\item schedule-current.pdf
\item rooms-current.pdf
\end{itemize}


\section{Scripts}

\subsection{Add New Lab - addNewLab.py}
%	\begin{lstlisting}[backgroundcolor = \color{lightgray},
 %                  language = python,
  %                 xleftmargin = -4cm,
   %                framexleftmargin = 1em,
    %               xrightmargin = -4cm,
     %             framexrightmargin = 1em
      %             ]


\lstinputlisting[label = addnNew, language=python, backgroundcolor = \color{light-gray}, basicstyle = \footnotesize, xleftmargin = -3cm, xrightmargin = -3cm]{/usr/local/master/pjl-web/dev/python-tools/repositoryEdit.py}

\lstinputlisting[label = liveUpdate, language=python, backgroundcolor = \color{light-gray}, basicstyle = \footnotesize, xleftmargin = -3cm, xrightmargin = -3cm]{/usr/local/master/pjl-web/dev/python-tools/liveUpdate.py}

%\end{lstlisting}

%\end{adjustwidth}
\end{document}
