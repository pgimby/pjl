var mainxmlpath="/data/labDB.xml";var equipmentdatabasepath="/data/equipmentDB.xml";var zipoutputfilename="PJL-lab-docs.zip";var siteroot="";var recordmasklength=20;function initRepoPage(){loadXML();$("#search-bar").val("")}
function initLandingPage(){console.log("landing page initalized")}
function initEquipmentModPage(){loadEquipmentXML(populateEquipDisplay)}
function initEquipmentPage(){equipmentPageQueryString();loadEquipmentXML(enableEquipmentSearchAutoComplete,populateEquipmentFilters,createEquipRecordSnapshots)}
function enableEquipmentSearchAutoComplete(xml){let namenodes=xml.getElementsByTagName("InventoryName");let datalist=d3.select("#equipment-datalist");let names=[];for(let i=0;i<namenodes.length;i++){datalist.append("option").attr("value",(namenodes[i].childNodes[0]?namenodes[i].childNodes[0].nodeValue:"—"))}}
function populateEquipmentFilters(xml){let manufacturers=new Set(["—"]);let rooms=new Set([]);let mannodes=xml.getElementsByTagName("Manufacturer");let roomnodes=xml.getElementsByTagName("Room");for(let i=0;i<mannodes.length;i++){manufacturers.add((mannodes[i].childNodes[0]?mannodes[i].childNodes[0].nodeValue:"—"))}
for(let i=0;i<roomnodes.length;i++){rooms.add((roomnodes[i].childNodes[0]?roomnodes[i].childNodes[0].nodeValue:"—"))}
let manlist=d3.select("#manufacturer-select");let roomlist=d3.select("#room-select");for(let item of manufacturers){manlist.append("option").attr("value",item).html(item)}
for(let item of rooms){roomlist.append("option").attr("value",item).html(item)}}
function equipmentPageQueryString(){let url=window.location.href.split("?");let queryobj={};if(url.length>1){var query=url[1].split("&");for(let i=0;i<query.length;i++){let param=query[i].split("=");queryobj[param[0]]=param[1]}
if(queryobj.id){new EquipmentDisplay(queryobj.id)}}}
function loadEquipmentXML(){let args=arguments;var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(xhttp.readyState==4&&xhttp.status==200){let docXML=xhttp.responseXML;for(let i=0;i<args.length;i++){args[i](docXML)}}};xhttp.open("GET",siteroot+"/data/equipmentDB.xml",!0);xhttp.send()}
function populateEquipDisplay(xml){container=d3.select("main");items=xml.getElementsByTagName("Item");for(let i=0;i<items.length;i++){item=container.append("div").classed("eq-item-display",!0);item.append("h2").classed("eq-item-text",!0).html(items[i].getElementsByTagName("InventoryName")[0].childNodes[0].nodeValue);item.append("a").classed("eq-item-pdf",!0).html("PDF").attr("data",items[i].getAttribute("id"))}
sortEquipList();linkPDFs()}
function createEquipRecordSnapshots(xml){var equiplist=xml.getElementsByTagName("Item");for(let i=0;i<equiplist.length;i++){let eqid=equiplist[i].getAttribute("id");let eqname=(equiplist[i].getElementsByTagName("InventoryName")[0].childNodes[0]?equiplist[i].getElementsByTagName("InventoryName")[0].childNodes[0].nodeValue:"—");let eqmake=(equiplist[i].getElementsByTagName("Manufacturer")[0].childNodes[0]?equiplist[i].getElementsByTagName("Manufacturer")[0].childNodes[0].nodeValue:"—");let eqmodel=(equiplist[i].getElementsByTagName("Model")[0].childNodes[0]?equiplist[i].getElementsByTagName("Model")[0].childNodes[0].nodeValue:"—");let snapshot=d3.select("#record-list-box").append("div").classed("eq-record-flex",!0).classed("record-rendered",!0);let id=snapshot.append("p").classed("eq-record-id",!0).html(eqid);let make=snapshot.append("p").classed("eq-record-make",!0).html(eqmake);let model=snapshot.append("p").classed("eq-record-model",!0).html(eqmodel);let name=snapshot.append("p").classed("eq-record-name",!0).html(eqname);let roomnodes=equiplist[i].getElementsByTagName("Room");let rooms=[];for(let r=0;r<roomnodes.length;r++){rooms.push(roomnodes[r].childNodes[0].nodeValue)}
snapshot.attr("data-rooms",rooms.join());let repair=(equiplist[i].getElementsByTagName("UnderRepair")[0].childNodes[0]?equiplist[i].getElementsByTagName("UnderRepair")[0].childNodes[0].nodeValue:"—");snapshot.attr("data-repair",repair)}
applyRecordsMask(!0);displayNumResults(countNumRecords())}
$(document).on("click",".eq-record-flex",function(e){new EquipmentDisplay($(e.target).children(".eq-record-id").text())});$(document).on("click","#edit-mode-button",function(e){window.location="./edit/"});class EquipmentDisplay{constructor(id){var self=this;self.id=id;self.modalmask=d3.select("body").append("div").classed("modal-screen",!0).style("display","block");self._loadEquipDB=function(){var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(xhttp.readyState==4&&xhttp.status==200){let docXML=xhttp.responseXML;let data=self._getItemData(docXML,self.id);self._buildDisplay(data)}};xhttp.open("GET",siteroot+equipmentdatabasepath,!0);xhttp.send()}
self._getItemData=function(xml,id){let nodes=xml.getElementsByTagName("Item");for(let i=0;i<nodes.length;i++){if(nodes[i].getAttribute("id")==id){return nodes[i]}}}
self._buildDisplay=function(data){let name=(data.getElementsByTagName("InventoryName")[0].childNodes[0]?data.getElementsByTagName("InventoryName")[0].childNodes[0].nodeValue:"none");let make=(data.getElementsByTagName("Manufacturer")[0].childNodes[0]?data.getElementsByTagName("Manufacturer")[0].childNodes[0].nodeValue:"none");let model=(data.getElementsByTagName("Model")[0].childNodes[0]?data.getElementsByTagName("Model")[0].childNodes[0].nodeValue:"none");let locations=[];let locationnodes=data.getElementsByTagName("Locations")[0].getElementsByTagName("Location");for(let i=0;i<locationnodes.length;i++){let room=locationnodes[i].getElementsByTagName("Room")[0].childNodes[0].nodeValue;let storage=locationnodes[i].getElementsByTagName("Storage")[0].childNodes[0].nodeValue;locations.push({"room":room,"storage":storage})}
let total=(data.getElementsByTagName("Total")[0].childNodes[0]?data.getElementsByTagName("Total")[0].childNodes[0].nodeValue:"N/A")
let service=(data.getElementsByTagName("InService")[0].childNodes[0]?data.getElementsByTagName("InService")[0].childNodes[0].nodeValue:"N/A")
let repair=(data.getElementsByTagName("UnderRepair")[0].childNodes[0]?data.getElementsByTagName("UnderRepair")[0].childNodes[0].nodeValue:"N/A")
let docs=[];let docnodes=data.getElementsByTagName("Document");for(let i=0;i<docnodes.length;i++){let name=docnodes[i].getElementsByTagName("Name")[0].childNodes[0].nodeValue;let path=docnodes[i].getElementsByTagName("Location")[0].childNodes[0].nodeValue;docs.push({"name":name,"path":path})}
let modal=self.modalmask.append("div").classed("eq-modal",!0);let header=modal.append("div").classed("eq-modal-header",!0);header.append("h1").classed("eq-modal-title",!0).html("Inventory");header.append("i").classed("fa fa-times fa-2x modal-close-button",!0).attr("aria-hidden","true");let content=modal.append("div").classed("eq-modal-content",!0);let img=content.append("div").classed("eq-modal-img",!0);img.append("img").attr("src","/img/img-placeholder.png");let ident=content.append("div").classed("eq-modal-id",!0);ident.append("h3").classed("eq-modal-name",!0).html(name);let mm=ident.append("div").classed("eq-make-model",!0);mm.append("p").classed("eq-make",!0).html(make);mm.append("p").classed("eq-model",!0).html(model);let locs=content.append("div").classed("eq-modal-locations",!0);locs.append("h1").classed("modal-header",!0).html("Locations");for(let i=0;i<locations.length;i++){locs.append("p").classed("eq-modal-location",!0).html(locations[i].room+" "+locations[i].storage)}
let amts=content.append("div").classed("eq-modal-amounts",!0);amts.append("h1").classed("modal-header",!0).html("Amounts");let amt1=amts.append("div").classed("eq-modal-amount total",!0);amt1.append("h2").html(total);amt1.append("h3").html("Total");let amt2=amts.append("div").classed("eq-modal-amount service",!0);amt2.append("h2").html(service);amt2.append("h3").html("In Service");let amt3=amts.append("div").classed("eq-modal-amount repair",!0);amt3.append("h2").html(repair);amt3.append("h3").html("Under Repair");let dcs=content.append("div").classed("eq-modal-docs",!0);dcs.append("h1").classed("modal-header",!0).html("Documents");for(let i=0;i<docs.length;i++){let dc=dcs.append("div").classed("eq-modal-doc",!0);dc.append("i").classed("fa fa-file-o",!0).attr("aria-hidden","true");dc.append("a").attr("href",docs[i].path).attr("target","_blank").html(docs[i].name)}}
self._setEventListeners=function(){$(document).on("click",".modal-screen",self.removeForm);$(document).on("click",".eq-modal",function(e){e.stopPropagation()});$(document).on("click",".modal-close-button",self.removeForm)}
self.removeForm=function(){self.modalmask.remove();$("main").removeClass("blurred-page");$(document).off("click",".modal-screen");$(document).off("click",".eq-modal");$(document).off("click",".modal-close-button")}
self._loadEquipDB();self._setEventListeners();$("main").addClass("blurred-page")}}
class DownloadModalWindow{constructor(id){var self=this;self.id=id;self.modalmask=d3.select("body").append("div").classed("modal-screen",!0).style("display","block");self._buildWindow=function(){let modal=self.modalmask.append("div").classed("dl-modal",!0);let header=modal.append("div").classed("dl-modal-header",!0);header.append("h1").classed("dl-modal-title",!0).html("Download Options<br><span id='dl-modal-number'></span>");header.append("i").classed("fa fa-times fa-2x modal-close-button",!0).attr("aria-hidden","true");let content=modal.append("div").classed("dl-modal-content",!0);let msg=content.append("p").html("Select which types of files you want to download or download everything.");let chk1=content.append("div").classed("dl-modal-check",!0).attr("id","PDF");chk1.append("i").classed("fa fa-file-o fa-2x",!0).attr("aria-hidden","true");let div1=chk1.append("dl-modal-item-content",!0);div1.append("h3").html("PDF");div1.append("p").html("PDF of the final lab document (.pdf)");let chk2=content.append("div").classed("dl-modal-check",!0).attr("id","TEX");chk2.append("i").classed("fa fa-file-o fa-2x",!0).attr("aria-hidden","true");let div2=chk2.append("dl-modal-item-content",!0);div2.append("h3").html("TEX");div2.append("p").html("LaTeX source documents for the lab (.tex)");let chk3=content.append("div").classed("dl-modal-check",!0).attr("id","MEDIA");chk3.append("i").classed("fa fa-file-o fa-2x",!0).attr("aria-hidden","true");let div3=chk3.append("dl-modal-item-content",!0);div3.append("h3").html("Media");div3.append("p").html("Images and video files (.tiff, .png, .jpeg, .gif, .mp4, .avi, .dv)");let chk4=content.append("div").classed("dl-modal-check",!0).attr("id","TEMPLATES");chk4.append("i").classed("fa fa-file-o fa-2x",!0).attr("aria-hidden","true");let div4=chk4.append("dl-modal-item-content",!0);div4.append("h3").html("Templates");div4.append("p").html("Data templates used in the experiment (.cmbl, .xlxs, .dat, .csv, .tsv, .txt)");let chk5=content.append("div").classed("dl-modal-check",!0).attr("id","EXTRA");chk5.append("i").classed("fa fa-file-o fa-2x",!0).attr("aria-hidden","true");let div5=chk5.append("dl-modal-item-content",!0);div5.append("h3").html("Support Documents");div5.append("p").html("Supporting documents for the lab and its development (various)");let chk6=content.append("div").classed("dl-modal-check checked",!0).attr("id","ALL");chk6.append("i").classed("fa fa-file-o fa-2x",!0).attr("aria-hidden","true");let div6=chk6.append("dl-modal-item-content",!0);div6.append("h3").html("Everything");div6.append("p").html("All files associated with the lab (various)");let footer=modal.append("div").classed("dl-modal-footer",!0);footer.append("h3").classed("dl-modal-confirm",!0).html("Download")}
self._setEventListeners=function(){$(document).on("click",".modal-screen",self.removeWindow);$(document).on("click",".dl-modal",function(e){e.stopPropagation()});$(document).on("click",".modal-close-button",self.removeWindow);$(document).on("click",".dl-modal-footer",function(e){var all=$("#ALL").hasClass("checked");var pdf=$("#PDF").hasClass("checked");var tex=$("#TEX").hasClass("checked");var tmp=$("#TEMPLATES").hasClass("checked");var med=$("#MEDIA").hasClass("checked");var extradocs=$("#EXTRA").hasClass("checked");self.removeWindow();$("#zip-progress-bar").slideDown(200,function(){collectFiles2Zip(all,pdf,tex,tmp,med,extradocs)})})}
self.removeWindow=function(){self.modalmask.remove();$("main").removeClass("blurred-page");$(document).off("click",".modal-screen");$(document).off("click",".modal-close-button");$(document).off("click",".dl-modal");$(document).off("click",".dl-modal-footer")}
$("main").addClass("blurred-page");self._buildWindow();self._setEventListeners()}}
$(document).on("click",".lab-details-drop-icon-flex",function(e){var extendeddataflex=$(e.target).parent().siblings(".lab-record-detailed-flex");extendeddataflex.stop().slideToggle("fast")});$(document).on("click","#clear-filters-button",function(e){var selects=$("select");for(var i=selects.length-1;i>=0;i--){$(selects[i]).val([])}
console.log(selects)
filterResults(getCurrentFilter(),fullset=!0);displayNumResults(countNumRecords());applyRecordsMask(!0)});$(document).on("click","#show-recent-button",function(e){showMostRecent()});$(document).on("click","select",function(e){filterResults(getCurrentFilter());displayNumResults(countNumRecords());applyRecordsMask(!0)});$(document).on("change","select",function(e){filterResults(getCurrentFilter());displayNumResults(countNumRecords());applyRecordsMask(!0)});$(document).on("mousedown","option",function(e){e.preventDefault();$(this).prop('selected',!$(this).prop('selected'));return!1});$(document).on("click",".search-icon",function(e){searchQueryHandler();applyRecordsMask(!0)});$(document).on("keypress","#search-bar",function(e){var key=e.which;console.log("enter")
if(key==13){console.log(key,13)
$(".search-icon").click();return!1}});$(document).on("click","#search-help-button",function(e){$(".search-container").toggleClass("search-help-opened");$(e.target).next().stop().slideToggle(300)});$(document).on("click","#zip-icon",function(e){new DownloadModalWindow();$("#dl-modal-number").text("("+String(countNumRecords())+" records selected)")});$(document).on("click",".dl-modal-check",function(e){let checkitem=$(e.target);if(checkitem.attr("id")=="ALL"&&checkitem.hasClass("checked")){return}else if(checkitem.attr("id")=="ALL"&&!checkitem.hasClass("checked")){checkitem.toggleClass("checked");checkitem.siblings().removeClass("checked")}else if(checkitem.attr("id")!="ALL"&&$(".dl-modal-check#ALL").hasClass("checked")){checkitem.toggleClass("checked");$(".dl-modal-check#ALL").removeClass("checked")}else if(checkitem.attr("id")!="ALL"&&!$(".dl-modal-check#ALL").hasClass("checked")){checkitem.toggleClass("checked")}
if(!$(".dl-modal-check").hasClass("checked")){$(".dl-modal-check#ALL").addClass("checked")}});$(document).on("click","#sort-name",function(e){sortRecords("name")});$(document).on("click","#sort-year",function(e){sortRecords("year")});$(document).on("click","#sort-semester",function(e){sortRecords("semester")});$(document).on("click","#sort-course",function(e){sortRecords("course")});$(document).on("click","#sort-eq-id",function(e){sortRecords("eq-id")});$(document).on("click","#sort-eq-make",function(e){sortRecords("eq-make")});$(document).on("click","#sort-eq-model",function(e){sortRecords("eq-model")});$(document).on("click","#sort-eq-name",function(e){sortRecords("eq-name")});$(document).on("click",".download-icon",function(e){window.open(siteroot+$(e.target).parent().parent().find(".version-path").attr("href"),"_blank")});$(document).on("click","#expand-all-button",function(e){flash($("#records-header"));var expanded=$(e.target).attr("expanded");if(expanded=="true"){toggleRecordExpansion(!1)}else{toggleRecordExpansion(!0)}});$(document).on("click","#show-all-button",function(e){$(e.target).css("visibility","hidden");applyRecordsMask(!1);falsifySort([$("#sort-year"),$("#sort-course"),$("#sort-semester"),$("#sort-name")])});$(document).on("click","#staff-name-ernst",function(e){window.open("http://phas.ucalgary.ca/phas_info/profiles/wesley-ernst")});$(document).on("click","#staff-name-gimby",function(e){window.open("http://phas.ucalgary.ca/phas_info/profiles/peter-gimby")});$(document).on("mouseenter",".resource-button",function(e){$(e.target).children(".resource-dropdown").slideDown("fast")});$(document).on("mouseleave",".resource-button",function(e){$(e.target).children(".resource-dropdown").hide()});$(document).on("mouseleave",".resource-dropdown",function(e){if($(e.target).is("p")){$(e.target).parent().parent().hide()}else if($(e.target).hasClass(".resource-dropdown-content")){$(e.target).parent().hide()}else{$(e.target).hide()}});$(document).on("click",".resource-dropdown-content, .mobile-resource-dropdown-content",function(e){var links={"pjl-regress":"/","pjl-lab-schedule":"/data/schedules/schedule-current.pdf","pjl-rooms-schedule":"/data/schedules/rooms-current.pdf","pjl-geiger":"/","pjl-repository":"/repository","pjl-linearization":"/","pjl-compare-two":"/","pjl-uncertainty":"/","pjl-graphing":"/","pjl-scint":"/","pjl-latex-template":"/","pjl-tikz-examples":"/","pjl-inventory":"/staffresources/equipment","pjl-github":"https://github.com/pgimby/pjl-web","pjl-lab-rules":"/data/safety/lab-rules/Lab-Rules.pdf","pjl-rad-safety":"/data/safety/training/Radiation-Safety/Radiation-Safety.pdf","pjl-orientation":"/data/safety/training/Orientation.pdf","pjl-hacf-pjl":"/data/safety/HACFs/HACF-PJL.pdf","pjl-hacf-adv":"/data/safety/HACFs/HACF-TA-ADV.pdf","pjl-hacf-std":"/data/safety/HACFs/HACF-TA-STD.pdf"}
var buttonid=$(e.target).attr("id");window.location=links[buttonid]});$(document).on("click touch",".need-help",function(e){window.location.href="mailto:pgimby@phas.ucalgary.ca?Subject=PJLWeb%20Bug%20Report";e.stopPropagation()});$(document).on("click touch","body",function(e){hideMobileNav();e.stopPropagation()});$(document).on("click touch","#mobile-nav-button",function(e){showMobileNav();e.stopPropagation()});$(document).on("click",".eq-item-text",function(e){$("main").addClass("blurred-page");let id=$(e.target).next().attr("data");let form=new EquipmentModForm(id);e.stopPropagation()})
function populateRecordList(docXML){var labs=docXML.getElementsByTagName("Lab");for(var i=labs.length-1;i>=0;i--){createRecordSnapshots(labs[i])}
displayNumResults(countNumRecords())}
function populateFilters(docXML){var types=["Course","Year","Semester","Discipline","Topic"];for(var i=types.length-1;i>=0;i--){var validlist=getValidFilterOptions(docXML,types[i]);for(var j=validlist.length-1;j>=0;j--){d3.select("#"+types[i].toLowerCase()+"-select").append("option").attr("value",validlist[j]).html(validlist[j])}}}
function createRecordSnapshots(lab){var versionlist=getVersionList(lab);for(var i=versionlist.length-1;i>=0;i--){var detailsbox=d3.select("#record-list-box").append("div").classed("lab-record-flex",!0).classed("record-rendered",!0);var snapshot=detailsbox.append("div").classed("lab-record-simple-flex",!0);var download=snapshot.append("a").classed("version-path",!0).html("Download").attr("href",siteroot+versionlist[i].path).attr("target","_blank");snapshot.append("img").classed("download-icon",!0).html("Download").attr("src",siteroot+"/img/download-icon.svg");var course=snapshot.append("p").classed("courses",!0).html(versionlist[i].course);var date=snapshot.append("p").classed("version-semester",!0).html(versionlist[i].semester+" "+versionlist[i].year);var labtitle=snapshot.append("p").classed("lab-title",!0).html(lab.getElementsByTagName("Name")[0].childNodes[0].nodeValue);var dropiconflex=snapshot.append("div").classed("lab-details-drop-icon-flex",!0);var dropicon=dropiconflex.append("img").classed("lab-details-drop-icon",!0).attr("src",siteroot+"/img/dropdown-arrow.png");var extendedlabdata=detailsbox.append("div").classed("lab-record-detailed-flex",!0).attr("style","display: none");var labid=extendedlabdata.append("p").classed("lab-data-id",!0).html("<span>Lab ID:</span> "+getLabId(lab));var labtopics=extendedlabdata.append("p").classed("lab-data-topics",!0).html("<span>Topics:</span> "+getLabTopicsList(lab).join(", "));var labdisciplines=extendedlabdata.append("p").classed("lab-data-disciplines",!0).html("<span>Disciplines:</span> "+getLabDisciplinesList(lab).join(", "));var labequipment=extendedlabdata.append("div").classed("lab-data-equipment",!0);getLabEquipmentList(lab,labequipment);var software=extendedlabdata.append("p").classed("lab-data-software",!0).html("<span>Software:</span> "+getLabSoftwareList(lab).join(", "));var directory=extendedlabdata.append("p").classed("version-directory",!0).html(versionlist[i].directory).style("display","none");var labdoclist=getExtraLabDocs(lab);var labdocs=extendedlabdata.append("div").classed("extra-docs",!0);labdocs.append("p").html("<span>Additional Documents:</span> ");for(var j=labdoclist.length-1;j>=0;j--){labdocs.append("a").classed("extra-doc",!0).attr("href",labdoclist[j].url).html(labdoclist[j].name).attr("target","_blank")}}}
function getLabEquipmentList(lab,selection){let equipnode=lab.getElementsByTagName("Equipment")[0];let items=equipnode.getElementsByTagName("Item");selection.append("p").classed("equipment-label",!0).html("<span>Equipment: </span>");for(let i=0;i<items.length;i++){let alt=(Boolean(items[i].getElementsByTagName("Alt")[0])?{name:items[i].getElementsByTagName("Alt")[0].childNodes[0].nodeValue,id:items[i].getAttribute("id")}:null);let item={};item.name=items[i].getElementsByTagName("Name")[0].childNodes[0].nodeValue;item.id=items[i].getAttribute("id");item.amount=items[i].getElementsByTagName("Amount")[0].childNodes[0].nodeValue;item.alt=alt;let eqitem=selection.append("div").classed("equip-item",!0);eqitem.append("p").classed("equip-item-primary",!0).attr("data-eqid",item.id).html(item.name);eqitem.append("p").classed("equip-item-amount",!0).html("("+String(item.amount)+")");if(Boolean(item.alt)){eqitem.append("p").classed("equip-item-alt",!0).attr("data-eqid",item.alt.id).html("["+item.alt.name+"]")}}}
$(document).on("click",".equip-item-primary, .equip-item-alt",function(e){let item=$(e.target);let id=item.attr("data-eqid");let href="/staffresources/equipment?id="+id
window.open(href,"_blank")});function isEquipmentDatabase(){return(document.title=="Physics Junior Laboratory - Equipment Database"?!0:!1)}
function interpretRepairFilter(value){switch(value){case "0":return[0,0.1];case "1-2":return[1,2];case "3-5":return[3,5];case ">5":return[5,9999];default:return[0,9999]}}
function filterResults(filter,fullset=!0){if(isEquipmentDatabase()){if(fullset){var recordlist=$(".eq-record-flex")}else{var recordlist=getCurrentRecords()}
var numrecords=recordlist.length;for(let i=0;i<recordlist.length;i++){let item=$(recordlist[i]);let id=item.find(".eq-record-id").text();let make=item.find(".eq-record-make").text();let rooms=item.attr("data-rooms").split(",");let repair=(item.attr("data-repair")=="—"?-1:parseFloat(item.attr("data-repair")));if(filter["manufacturer-filter"].includes(make)||filter["manufacturer-filter"].length==0){item.removeClass("record-not-rendered masked").addClass("record-rendered")}else{item.removeClass("record-rendered masked").addClass("record-not-rendered");continue}
if(doArraysOverlap(rooms,filter["room-filter"])||filter["room-filter"].length==0){item.removeClass("record-not-rendered masked").addClass("record-rendered")}else{item.removeClass("record-rendered masked").addClass("record-not-rendered");continue}
let repairrange=interpretRepairFilter(filter["repair-filter"]);if((repair>=repairrange[0]&&repair<repairrange[1])||filter["repair-filter"].length==0){item.removeClass("record-not-rendered masked").addClass("record-rendered")}else{item.removeClass("record-rendered masked").addClass("record-not-rendered");continue}}}else{if(fullset){var recordlist=$(".lab-record-flex")}else{var recordlist=getCurrentRecords()}
var numrecords=recordlist.length;for(let i=recordlist.length-1;i>=0;i--){let lab=$(recordlist[i]);let courses=lab.find(".courses").text().split(", ");let disciplines=lab.find(".lab-data-disciplines").text().slice(13,).split(", ");let topics=lab.find(".lab-data-topics").text().slice(8,).split(", ");if(filter["year-filter"].includes(lab.find(".version-semester").text().slice(-4))||filter["year-filter"].length==0){lab.removeClass("record-not-rendered masked").addClass("record-rendered")}
else if(lab.find(".version-semester").text().endsWith("—")&&filter["year-filter"].includes("—")){lab.removeClass("record-not-rendered masked").addClass("record-rendered")}else{lab.removeClass("record-rendered masked").addClass("record-not-rendered");continue}
if(doArraysOverlap(courses,filter["course-filter"])||filter["course-filter"].length==0){lab.removeClass("record-not-rendered masked").addClass("record-rendered")}else{lab.removeClass("record-rendered masked").addClass("record-not-rendered");continue}
if(filter["semester-filter"].includes(lab.find(".version-semester").text().slice(0,-5))||filter["semester-filter"].length==0){lab.removeClass("record-not-rendered masked").addClass("record-rendered")}else if(lab.find(".version-semester").text().startsWith("—")&&filter["semester-filter"].includes("—")){lab.removeClass("record-not-rendered masked").addClass("record-rendered")}else{lab.removeClass("record-rendered masked").addClass("record-not-rendered");continue}
if(doArraysOverlap(disciplines,filter["discipline-filter"])||filter["discipline-filter"].length==0){lab.removeClass("record-not-rendered masked").addClass("record-rendered")}else{lab.removeClass("record-rendered masked").addClass("record-not-rendered");continue}
if(doArraysOverlap(topics,filter["topic-filter"])||filter["topic-filter"].length==0){lab.removeClass("record-not-rendered masked").addClass("record-rendered")}else{lab.removeClass("record-rendered masked").addClass("record-not-rendered");continue}}
falsifySort([$("#sort-year"),$("#sort-semester"),$("#sort-name"),$("#sort-course")]);$("#record-list-box").removeClass("records-unmasked")}}
function displayNumResults(numresults){$("#num-results").text(numresults);updateZipStatus()}
function updateZipStatus(){let canzip=canZip()
if(canzip){$("#zip-icon").css("display","inline-block")}else{$("#zip-icon").css("display","none")}}
function sortRecords(by){var records=getCurrentRecords();let recordlistbox=$("#record-list-box");for(let record of records){record.detach()}
switch(by){case "course":if($("#sort-course").attr("sorted")=="true"){records.reverse()}else{records.sort(compareLabsByCourse)}
truifySort([$("#sort-course")]);falsifySort([$("#sort-year"),$("#sort-semester"),$("#sort-name")]);break;case "semester":if($("#sort-semester").attr("sorted")=="true"){records.reverse()}else{records.sort(compareLabsBySemester)}
truifySort([$("#sort-semester")]);falsifySort([$("#sort-year"),$("#sort-course"),$("#sort-name")]);break;case "year":if($("#sort-year").attr("sorted")=="true"){records.reverse()}else{records.sort(compareLabsByYear)}
truifySort([$("#sort-year")]);falsifySort([$("#sort-semester"),$("#sort-course"),$("#sort-name")]);break;case "name":if($("#sort-name").attr("sorted")=="true"){records.reverse()}else{records.sort(compareLabsByName)}
truifySort([$("#sort-name")]);falsifySort([$("#sort-year"),$("#sort-course"),$("#sort-semester")]);break;case "eq-id":if($("#sort-eq-id").attr("sorted")=="true"){records.reverse()}else{records.sort(compareEquipById)}
truifySort([$("#sort-eq-id")]);falsifySort([$("#sort-eq-make"),$("#sort-eq-model"),$("#sort-eq-name")]);break;case "eq-make":if($("#sort-eq-make").attr("sorted")=="true"){records.reverse()}else{records.sort(compareEquipByMake)}
truifySort([$("#sort-eq-make")]);falsifySort([$("#sort-eq-id"),$("#sort-eq-model"),$("#sort-eq-name")]);break;case "eq-model":if($("#sort-eq-model").attr("sorted")=="true"){records.reverse()}else{records.sort(compareEquipByModel)}
truifySort([$("#sort-eq-model")]);falsifySort([$("#sort-eq-make"),$("#sort-eq-id"),$("#sort-eq-name")]);break;case "eq-name":if($("#sort-eq-name").attr("sorted")=="true"){console.log("reverse")
records.reverse()}else{console.log("forward")
records.sort(compareEquipByName)}
truifySort([$("#sort-eq-name")]);falsifySort([$("#sort-eq-make"),$("#sort-eq-model"),$("#sort-eq-id")]);break}
for(let i=0;i<records.length;i++){if(!recordlistbox.hasClass("records-unmasked")){if(i<recordmasklength){console.log(i,records[i].find(".lab-data-id").text())
records[i].removeClass("masked")}else{records[i].addClass("masked")}}
recordlistbox.append(records[i])}}
function falsifySort(headers){for(var i=headers.length-1;i>=0;i--){headers[i].attr("sorted","false")}}
function truifySort(headers){for(var i=headers.length-1;i>=0;i--){headers[i].attr("sorted","true")}}
function toggleRecordExpansion(truthy){var button=$("#expand-all-button");if(Boolean(truthy)){var extendeddatarecords=$(".lab-record-detailed-flex");for(var i=extendeddatarecords.length-1;i>=0;i--){var record=$(extendeddatarecords[i]).parent();if(record.hasClass("record-rendered")&&record.filter(".record-rendered").length<100){$(extendeddatarecords[i]).stop().slideDown()}else{$(extendeddatarecords[i]).css("display","flex")}}
setExpandedButtonTruth(!0)}else{var extendeddatarecords=$(".lab-record-detailed-flex");for(var i=extendeddatarecords.length-1;i>=0;i--){var record=$(extendeddatarecords[i]).parent();if(record.hasClass("record-rendered")&&record.filter(".record-rendered").length<100){$(extendeddatarecords[i]).stop().slideUp()}else{$(extendeddatarecords[i]).css("display","none")}}
setExpandedButtonTruth(!1)}}
function setExpandedButtonTruth(truthy){var button=$("#expand-all-button");button.attr("expanded",String(Boolean(truthy)));if(Boolean(truthy)){button.html("collapse all")}else{button.html("expand all")}}
function applyRecordsMask(truthy){var masksize=20;var records=getCurrentRecords();unmaskAll(records);if(records.length>masksize&&Boolean(truthy)){for(var i=records.length-1;i>=masksize;i--){records[i].addClass("masked")}
$("#num-unmasked-results").text(String(masksize));$("#show-all-button").css("visibility","visible")}else{for(var i=records.length-1;i>=0;i--){records[i].removeClass("masked")}
$("#num-unmasked-results").text(String(records.length));$("#show-all-button").css("visibility","hidden")}
falsifySort([$("#sort-year"),$("#sort-semester"),$("#sort-name"),$("#sort-course")]);$("#record-list-box").addClass("records-unmasked");if(Boolean(truthy)){$("#record-list-box").removeClass("records-unmasked")}}
function unmaskAll(records){$("#record-list-box").addClass("records-unmasked");for(var i=records.length-1;i>=0;i--){records[i].removeClass("masked")}
$("#show-all-button").css("visibility","hidden")}
function setNumberRecordsUnmasked(){var records=getCurrentRecords();var num=records.length;for(var i=records.length-1;i>=0;i--){if(records[i].hasClass("masked")){num--}}
$("#num-unmasked-results").html(String(num))}
function showMostRecent(){var uniquelabs=[];var records=getCurrentRecords();unmaskAll(records);setNumberRecordsUnmasked();for(var i=records.length-1;i>=0;i--){var labid=records[i].find(".lab-data-id").text().slice(-4,);if(!uniquelabs.includes(labid)){uniquelabs.push(labid)}
records[i].removeClass("record-rendered").addClass("record-not-rendered")}
for(var i=uniquelabs.length-1;i>=0;i--){var year=0;var mostrecent=null;var sameyeardifcourse=[];for(var j=records.length-1;j>=0;j--){if(records[j].find(".lab-data-id").text().slice(-4,)==uniquelabs[i]){var recordsemester=records[j].find(".version-semester").text();var date=parseFloat(recordsemester.split(" ")[1])+parseFloat(semesterDecimal[recordsemester.split(" ")[0]]);if(date>year){mostrecent=records[j];year=date;sameyeardifcourse=[]}else if(date==year){sameyeardifcourse.push(records[j])
year=date}
if(!mostrecent&&recordsemester.split(" ")[1]=="—"){mostrecent=records[j]}}}
if(mostrecent){mostrecent.removeClass("record-not-rendered").addClass("record-rendered");for(var j=sameyeardifcourse.length-1;j>=0;j--){sameyeardifcourse[j].removeClass("record-not-rendered").addClass("record-rendered")}}}
sortRecords("year");sortRecords("year");displayNumResults(countNumRecords());setNumberRecordsUnmasked()}
function showMobileNav(){if($(".mobile-landing-nav").css("display")=="none"){$(".mobile-landing-nav").show("slide",{direction:"left"},300)}}
function hideMobileNav(){if($(".mobile-landing-nav").css("display")=="block"){$(".mobile-landing-nav").hide("slide",{direction:"left"},300)}}
var semesterDecimal={"Fall":0.75,"Winter":0.0,"Spring":0.25,"Summer":0.50}
function generateSearchResults(query,selector){let minsimilarity=0.4;let querybigrams=makeBigramList(query);let recordlist=getAllRecords();let recordtype=(isEquipmentDatabase()?"equipment":"lab")
let skipsim=("id"==selector?!0:!1)
switch(recordtype){case "equipment":for(let i=0;i<recordlist.length;i++){recordlist[i].removeClass("record-not-rendered masked").addClass("record-rendered");let similarity=compareQueryWithEquipRecord(querybigrams,recordlist[i]);if(similarity<.9){recordlist[i].removeClass("record-rendered").addClass("record-not-rendered")}}
break;case "lab":for(let i=0;i<recordlist.length;i++){recordlist[i].removeClass("record-not-rendered masked").addClass("record-rendered");let similarity=(skipsim?0.0:compareQueryWithLabRecord(querybigrams,recordlist[i],selector));if(similarity<minsimilarity&&!queryLiteralInLabRecord(query,recordlist[i],selector)){recordlist[i].removeClass("record-rendered").addClass("record-not-rendered")}}
break}}
function queryLiteralInLabRecord(query,lab,selector){var courses=lab.find(".courses").text().toLowerCase();var disciplines=lab.find(".lab-data-disciplines").text().slice(13,).toLowerCase();var topics=lab.find(".lab-data-topics").text().slice(8,).toLowerCase();var equipment=lab.find(".lab-data-equipment").text().slice(11,).toLowerCase();var semester=lab.find(".version-semester").text().split(" ")[0].toLowerCase();var year=lab.find(".version-semester").text().split(" ")[1].toLowerCase();var labtitle=lab.find(".lab-title").text().toLowerCase();var id=lab.find(".lab-data-id").text().slice(-4,).toLowerCase();switch(selector){case "all":return courses.includes(query)||disciplines.includes(query)||topics.includes(query)||equipment.includes(query)||semester.includes(query)||year.includes(query)||labtitle.includes(query);break;case "course":return courses.includes(query);break;case "lab":return labtitle.includes(query);break;case "year":return year.includes(query)
break;case "semester":return semester.includes(query)
break;case "topic":return topics.includes(query)
break;case "discipline":return disciplines.includes(query)
break;case "equipment":return equipment.includes(query)
break;case "id":return id==query;break}}
function compareQueryWithLabRecord(querybigrams,lab,selector){var courses=lab.find(".courses").text().split(", ");var disciplines=lab.find(".lab-data-disciplines").text().slice(13,).split(", ");var topics=lab.find(".lab-data-topics").text().slice(8,).split(", ");var equipment=lab.find(".lab-data-equipment").text().slice(11,).split(", ");courses=courses.map(function(d){return makeBigramList(d.slice(4,))});disciplines=disciplines.map(function(d){return makeBigramList(d)});topics=topics.map(function(d){return makeBigramList(d)});equipment=equipment.map(function(d){return makeBigramList(d)});var semester=[makeBigramList(lab.find(".version-semester").text().split(" ")[0])];var year=[makeBigramList(lab.find(".version-semester").text().split(" ")[1].slice(2,))];var labtitle=[makeBigramList(lab.find(".lab-title").text())];var totest=[""];switch(selector){case "all":totest=disciplines.concat(courses,semester,year,labtitle,topics,equipment);break;case "course":totest=courses;break;case "lab":totest=labtitle;break;case "year":totest=year;break;case "semester":totest=semester;break;case "topic":totest=topics;break;case "discipline":totest=disciplines;break;case "equipment":totest=equipment;break}
var max=0.0;for(var i=totest.length-1;i>=0;i--){var result=sorensenDiceCoef(querybigrams,totest[i]);if(result>max){max=result}}
return max}
function compareQueryWithEquipRecord(querybigrams,eqitem){let name=eqitem.find(".eq-record-name").html();let recordbigrams=makeBigramList(name);return sorensenDiceCoef(recordbigrams,querybigrams)}
function sorensenDiceCoef(bigrams1,bigrams2){var count=0;$.each(bigrams1,function(i,d){if(bigrams2.includes(d)){count++}});return 2*count/(bigrams1.length+bigrams2.length)}
function searchQueryHandler(){var query=$("#search-bar").val();var split=query.split(":");var selector=split[0];var searchphrase=split.slice(1,).join(" ");switch(selector.toLowerCase()){case "course":courseSearchHandler(searchphrase);break;case "lab":labSearchHandler(searchphrase);break;case "year":yearSearchHandler(searchphrase);break;case "semester":semesterSearchHandler(searchphrase);break;case "topic":topicSearchHandler(searchphrase);break;case "discipline":disciplineSearchHandler(searchphrase);break;case "equipment":equipmentSearchHandler(searchphrase);break;case "id":idSearchHandler(searchphrase);break;default:defaultSearchHandler(query)}}
function defaultSearchHandler(searchphrase){if(isEmptyString(searchphrase)){return}
switch(searchphrase){case "silly walk":mayISeeYourSillyWalk();break;case "I came here for an argument":iCameHereForAnArgument();break;case "show me something funny":window.open("https://xkcd.com",'_blank');break;default:$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"all");displayNumResults(countNumRecords());$("#search-bar").val("")}}
function courseSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"course");displayNumResults(countNumRecords());$("#search-bar").val("")}
function labSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"lab");displayNumResults(countNumRecords());$("#search-bar").val("")}
function yearSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"year");displayNumResults(countNumRecords());$("#search-bar").val("")}
function semesterSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"semester");displayNumResults(countNumRecords());$("#search-bar").val("")}
function topicSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"topic");displayNumResults(countNumRecords());$("#search-bar").val("")}
function disciplineSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"discipline");displayNumResults(countNumRecords());$("#search-bar").val("")}
function equipmentSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"equipment");displayNumResults(countNumRecords());$("#search-bar").val("")}
function idSearchHandler(searchphrase){$('html, body').animate({scrollTop:($('#record-list-box').offset().top)},500);generateSearchResults(searchphrase,"id");displayNumResults(countNumRecords());$("#search-bar").val("")}
function makePromisesBeginZip(filelist){var zip=new JSZip();var files=filelist;var promises=[];var xhrs=[];function increaseProgress(){return function(){let currentval=parseFloat($("#zip-progress-bar progress").attr("value"));let newval=currentval+(1/files.length)
$("#zip-progress-bar progress").attr("value",newval.toFixed(3))}}
for(let i=0;i<files.length;i++){let downloadingfile=new $.Deferred();downloadingfile.done(function(filename,blob){zip.file(filename,blob)},increaseProgress());let xhr=beginDownload(files[i],downloadingfile);promises.push(downloadingfile);xhrs.push(xhr)}
deferredzip=$.when.apply($,promises);deferredzip.done(function(){zip.generateAsync({type:"blob"}).then(function(blob){saveAs(blob,zipoutputfilename);console.log("zip done")
$("#zip-progress-bar progress").attr("value","0");$("#zip-progress-bar").stop().slideUp(500)});return!1});deferredzip.fail(function(){setTimeout(function(){$("#file-prep").text("Download failed.");setTimeout(function(){console.log("zip failed")
$("#zip-progress-bar progress").attr("value","0");$("#zip-progress-bar").stop().slideUp(500,function(){$("#file-prep").text("Preparing files...")})},2000)},700)});$(document).on("click","#cancel-download",function(e){for(var i=xhrs.length-1;i>=0;i--){xhrs[i].abort();promises[i].reject()}
console.log("zip cancelled")
$("#zip-progress-bar progress").attr("value","0");$("#zip-progress-bar").stop().slideUp(500);return})}
function fileDownloadPromise(){return new $.Deferred()}
function beginDownload(filepath,promise){var xhttp=new XMLHttpRequest();xhttp.responseType="blob";xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){blob=this.response;var filename=filepath.split("/");filename=filename[filename.length-1];promise.notify();promise.resolve(filename,blob)}else if(this.status==404){promise.reject()}else if(this.status==403){promise.reject()}};xhttp.open("GET",siteroot+filepath,!0);xhttp.send();return xhttp}
function canZip(){var bool=!1;if(countNumRecords()>0&&JSZip.support.blob){bool=!0}
return bool}
function collectFiles2Zip(doALL,doPDF,doTEX,doTMP,doMED,doEXTRA){var dirlist=[];var filelist=[];var promises=[];var extradocs=[];var records=getCurrentRecords();function fileCallback(promise){return function(d){filelist=filelist.concat(d.split(","));promise.resolve()}}
for(var i=records.length-1;i>=0;i--){dirlist.push(records[i].find(".version-directory").text());extradocs.concat(getExtraDocsFromRecord(records[i]))}
for(var i=dirlist.length-1;i>=0;i--){let promise=$.Deferred();promises.push(promise)
$.post(siteroot+"/php/getFileListRecursive.php","dirpath="+dirlist[i],fileCallback(promise))}
var deferredFileList=$.when.apply($,promises);deferredFileList.done(function(){filteredlist=filterFileList(doALL,doPDF,doTEX,doTMP,doMED,filelist);if(doEXTRA||doALL){filteredlist.concat(extradocs)}
makePromisesBeginZip(filteredlist);console.log("An elegant syntax for ease of use,\neasy reading. Not abstruse.\n\nHaving this would sure be swell.\nPHP can rot in hell.")});deferredFileList.fail(function(){console.log("File collection failed: Unable to locate files for selection.")})}
function filterFileList(doALL,doPDF,doTEX,doTMP,doMED,filelist){if(doALL){return filelist}
var filteredfiles=[];for(var i=filelist.length-1;i>=0;i--){if(!filelist[i].startsWith("/data/")){continue}
if(filelist[i].endsWith(".pdf")&&doPDF){filteredfiles.push(filelist[i]);continue}
if(filelist[i].endsWith(".tex")&&doTEX){filteredfiles.push(filelist[i]);continue}
if((filelist[i].endsWith(".txt")||filelist[i].endsWith(".dat")||filelist[i].endsWith(".xml")||filelist[i].endsWith(".xlsx")||filelist[i].endsWith(".ods")||filelist[i].endsWith(".csv")||filelist[i].endsWith(".tsv")||filelist[i].endsWith(".cmbl"))&&doTMP){filteredfiles.push(filelist[i]);continue}
if((filelist[i].endsWith(".png")||filelist[i].endsWith(".jpg")||filelist[i].endsWith(".jpeg")||filelist[i].endsWith(".gif")||filelist[i].endsWith(".tiff")||filelist[i].endsWith(".mp4")||filelist[i].endsWith(".avi")||filelist[i].endsWith(".dv"))&&doMED){filteredfiles.push(filelist[i]);continue}}
return filteredfiles}
function getExtraDocsFromRecord(record){var docs=$(record).children(".extra-docs").children(".extra-doc");list=[];for(var i=docs.length-1;i>=0;i--){let docname=docs[i].text();let docpath=docs[i].attr("href");list.push({name:docname,url:docpath})}
return list}
function loadXML(){var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(xhttp.readyState==4&&xhttp.status==200){let docXML=xhttp.responseXML;populateRecordList(docXML);populateFilters(docXML);applyRecordsMask(!0)}};xhttp.open("GET",siteroot+mainxmlpath,!0);xhttp.send()}
function sendEquipXMLModification(data){$.ajax({method:"POST",url:"/php/modifyEquipDB.php",data:data}).done(function(msg){alert("Data saved: "+msg)})}
function getCurrentRecords(){var list=[];var lablist=$(".lab-record-flex");if(isEquipmentDatabase()){let eqlist=$(".eq-record-flex");for(let i=0;i<eqlist.length;i++){if($(eqlist[i]).hasClass("record-rendered")){list.push($(eqlist[i]))}}}else{for(let i=0;i<lablist.length;i++){if($(lablist[i]).hasClass("record-rendered")){list.push($(lablist[i]))}}}
return list}
function getAllRecords(){var list=[];var lablist=$(".lab-record-flex");if(lablist.length>0){for(var i=lablist.length-1;i>=0;i--){list.push($(lablist[i]))}}else{let eqlist=$(".eq-record-flex");for(var i=0;i<eqlist.length;i++){list.push($(eqlist[i]))}}
return list}
function countNumRecords(){var currentrecords=getCurrentRecords();return currentrecords.length}
function getCurrentFilter(){let selects=$("select");let filter={};for(let i=selects.length-1;i>=0;i--){if(selects[i].value){filter[$(selects[i]).parent().attr("id")]=$(selects[i]).val()}else{filter[$(selects[i]).parent().attr("id")]=[]}}
return filter}
function getLabId(lab){return lab.getAttribute("labId")}
function mayISeeYourSillyWalk(){var itsnotparticularlysillyisit="The right leg isn't silly at all and the left leg merely does a forward aerial half turn every alternate step.";$(".search-icon").attr("src","/img/silly-walk.png");$(".search-icon").css({height:"45px",width:"35px",top:"-49px",right:"-35px"})
$("#search-bar").attr("placeholder",itsnotparticularlysillyisit);$("#search-bar").css("font-size","11px");$("#search-bar").val("");setTimeout(function(){$(".search-icon").attr("src","/img/search-icon.png");$(".search-icon").css({height:"40px",width:"40px",top:"-45px",right:"-35px"})
$("#search-bar").attr("placeholder","Keyword, topic, course...");$("#search-bar").css("font-size","1rem");$("#search-bar").val("")},6000)}
function getLabTopicsList(lab){var list=[];var topics=lab.getElementsByTagName("Topic");for(var i=topics.length-1;i>=0;i--){list.push(topics[i].childNodes[0].nodeValue)}
return list}
function getLabDisciplinesList(lab){var list=[];var disciplines=lab.getElementsByTagName("Discipline");for(var i=disciplines.length-1;i>=0;i--){list.push(disciplines[i].childNodes[0].nodeValue)}
return list}
function getLabSoftwareList(lab){var list=[];var software=lab.getElementsByTagName("Software")[0];var names=software.getElementsByTagName("Name");for(var i=names.length-1;i>=0;i--){list.push(names[i].childNodes[0].nodeValue)}
return list}
function getExtraLabDocs(lab){var list=[];var docs=lab.getElementsByTagName("Doc");for(var i=docs.length-1;i>=0;i--){var docname=docs[i].getElementsByTagName("Name")[0].childNodes[0].nodeValue;var docpath=docs[i].getElementsByTagName("Path")[0].childNodes[0].nodeValue;list.push({name:docname,url:docpath})}
return list}
function iCameHereForAnArgument(){var i=0;$(".search-icon").attr("src","/img/silly-walk.png");$(".search-icon").css({height:"45px",width:"35px",top:"-49px",right:"-35px"})
$("#search-bar").val("");var id=setInterval(function(){if(i==argument.length-1){clearInterval(id);$(".search-icon").attr("src","/img/search-icon.png");$(".search-icon").css({height:"40px",width:"40px",top:"-45px",right:"-35px"});$("#search-bar").val("");$("#search-bar").attr("placeholder","Keyword, topic, course...");return}
$("#search-bar").attr("placeholder",argument[i]);i++},1000)}
function getVersionList(lab){var versionlist=[];var list=lab.getElementsByTagName("Version");for(var i=list.length-1;i>=0;i--){var p=list[i].getElementsByTagName("Path")[0];var y=list[i].getElementsByTagName("Year")[0];var s=list[i].getElementsByTagName("Semester")[0];var c=list[i].getElementsByTagName("Course")[0];var d=list[i].getElementsByTagName("Directory")[0];versionlist.push({path:(Boolean(p.childNodes[0])?p.childNodes[0].nodeValue:"—"),semester:(Boolean(s.childNodes[0])?s.childNodes[0].nodeValue:"—"),year:(Boolean(y.childNodes[0])?y.childNodes[0].nodeValue:"—"),course:(Boolean(c.childNodes[0])?c.childNodes[0].nodeValue:"—"),directory:(Boolean(d.childNodes[0])?d.childNodes[0].nodeValue:null)})}
return versionlist}
function getValidFilterOptions(docXML,type){var nodelist=docXML.getElementsByTagName(type);var valueslist=[];for(var i=0;i<nodelist.length;i ++){var value=nodelist[i].childNodes[0];valueslist.push((Boolean(value)?value.nodeValue:"—"))}
return Array.from(new Set(valueslist)).sort()}
function getCurrentRecordPaths(){var paths=[];var records=getCurrentRecords();for(var i=records.length-1;i>=0;i--){paths.push(records[i].find(".version-path").attr("href"))}
return paths}
function compareLabsByCourse(a,b){var a=a.find(".courses").text().split(", ")[0];var b=b.find(".courses").text().split(", ")[0];if(a<b){return-1}
if(b<a){return 1}
return 0}
function compareLabsBySemester(a,b){var a=a.find(".version-semester").text().split(" ")[0];var b=b.find(".version-semester").text().split(" ")[0];if(a<b){return-1}
if(b<a){return 1}
return 0}
function compareLabsByYear(a,b){var a=a.find(".version-semester").text().split(" ")[1];var b=b.find(".version-semester").text().split(" ")[1];if(a<b){return-1}
if(b<a){return 1}
return 0}
function compareLabsByName(a,b){var a=a.find(".lab-title").text().toLowerCase();var b=b.find(".lab-title").text().toLowerCase();if(a<b){return-1}
if(b<a){return 1}
return 0}
function compareEquipById(a,b){var a=a.find(".eq-record-id").text().toLowerCase();var b=b.find(".eq-record-id").text().toLowerCase();if(a<b){return-1}
if(b<a){return 1}
return 0}
function compareEquipByMake(a,b){var a=a.find(".eq-record-make").text().toLowerCase();var b=b.find(".eq-record-make").text().toLowerCase();if(a<b){return-1}
if(b<a){return 1}
return 0}
function compareEquipByModel(a,b){var a=a.find(".eq-record-model").text().toLowerCase();var b=b.find(".eq-record-model").text().toLowerCase();if(a<b){return-1}
if(b<a){return 1}
return 0}
function compareEquipByName(a,b){var a=a.find(".eq-record-name").text().toLowerCase();var b=b.find(".eq-record-name").text().toLowerCase();if(a<b){return-1}
if(b<a){return 1}
return 0}
function flash(jQueryDOMSelection){jQueryDOMSelection.css("opacity",".8");jQueryDOMSelection.stop().animate({opacity:1},600)}
function doArraysOverlap(array1,array2){return array1.some(x=>array2.includes(x))}
function makeBigramList(string){list=[];var string=string.toLowerCase();for(var i=0;i<=string.length-2;i++){list.push(string[i]+string[i+1])}
return Array.from(new Set(list))}
function arithmeticMean(list){return list.reduce((a,b)=>a+b,0)/list.length}
function isEmptyString(string){return!string.replace(/\s/g,'').length}
function mostRecentDecimalSemester(){var date=new Date();return Math.round(date.getMonth()/3)/4}
function spanTheList(list,classname,ids){for(let i=list.length-1;i>=0;i--){list[i]="<span class='"+classname+"' data-eqid="+ids[i]+">"+String(list[i]).split("(")[0].trim()+"</span>"+" ("+String(list[i]).split("(")[1]}
return list} 
